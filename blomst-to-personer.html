<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>To Blomster — Når Energier Mødes</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300&family=Jost:wght@200;300;400&display=swap');

  :root {
    --bg: #f7f5f0;
    --ink: #1a1a2e;
    --accent: #c4a882;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Jost', sans-serif;
    background: var(--bg);
    color: var(--ink);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem 1rem;
    font-weight: 300;
  }

  h1 {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 300;
    font-size: clamp(1.4rem, 3vw, 2rem);
    letter-spacing: 0.04em;
    margin-bottom: 0.3rem;
    text-align: center;
  }

  .subtitle {
    font-size: 0.78rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #888;
    margin-bottom: 2rem;
    text-align: center;
  }

  .layout {
    display: flex;
    gap: 2.5rem;
    align-items: flex-start;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
    max-width: 1060px;
  }

  .canvas-wrap {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
  }

  canvas {
    background: white;
    border-radius: 4px;
    box-shadow: 0 2px 20px rgba(0,0,0,0.08);
    flex-shrink: 0;
  }

  .legend {
    display: flex;
    gap: 1.5rem;
    justify-content: center;
    font-size: 0.7rem;
    color: #888;
    letter-spacing: 0.05em;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .legend-swatch {
    width: 18px;
    height: 10px;
    border-radius: 2px;
  }

  .panel {
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
    min-width: 260px;
    max-width: 310px;
  }

  .section-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 0.92rem;
    font-weight: 400;
    letter-spacing: 0.04em;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #444;
  }

  .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
  }

  .control-group {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .control-group label {
    font-size: 0.68rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #999;
  }

  .slider-row {
    display: flex;
    align-items: center;
    gap: 0.8rem;
  }

  input[type=range] {
    flex: 1;
    -webkit-appearance: none;
    height: 2px;
    background: #ddd;
    outline: none;
    cursor: pointer;
  }

  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 13px;
    height: 13px;
    border-radius: 50%;
    background: var(--ink);
    cursor: pointer;
    transition: transform 0.15s;
  }

  input[type=range]::-webkit-slider-thumb:hover {
    transform: scale(1.3);
  }

  .val {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1rem;
    min-width: 36px;
    text-align: right;
    color: var(--ink);
  }

  .slider-labels {
    display: flex;
    justify-content: space-between;
    font-size: 0.58rem;
    color: #bbb;
    letter-spacing: 0.05em;
    margin-top: 0.1rem;
  }

  .divider {
    height: 1px;
    background: #e8e4dc;
    margin: 0.1rem 0;
  }

  .btn-row {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .preset-btn {
    background: var(--ink);
    color: white;
    border: none;
    padding: 0.45rem 0.9rem;
    font-family: 'Jost', sans-serif;
    font-weight: 300;
    font-size: 0.68rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    cursor: pointer;
    border-radius: 2px;
    transition: all 0.2s;
  }

  .preset-btn:hover { background: #3a4a9a; }
  .preset-btn:active { transform: scale(0.97); }

  .preset-btn.outline {
    background: transparent;
    color: var(--ink);
    border: 1px solid #ccc;
  }

  .preset-btn.outline:hover {
    border-color: #999;
    background: rgba(0,0,0,0.03);
  }

  .stats {
    background: white;
    border-radius: 4px;
    padding: 1rem 1.2rem;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  }

  .stats h3 {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 400;
    font-size: 0.95rem;
    margin-bottom: 0.6rem;
    color: #444;
    letter-spacing: 0.03em;
  }

  .stat-line {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.25rem 0;
    font-size: 0.75rem;
    border-bottom: 1px solid #f0f0f0;
  }

  .stat-line:last-child { border-bottom: none; }
  .stat-label { color: #888; letter-spacing: 0.04em; }

  .stat-val {
    font-family: 'Cormorant Garamond', serif;
    font-size: 0.95rem;
    font-weight: 400;
  }

  .harmony-wrap {
    margin-top: 0.6rem;
  }

  .harmony-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.65rem;
    color: #999;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 0.3rem;
  }

  .harmony-bar {
    height: 4px;
    background: #eee;
    border-radius: 2px;
    overflow: hidden;
  }

  .harmony-fill {
    height: 100%;
    background: linear-gradient(to right, rgba(100,115,175,0.75), #7B6F8B, rgba(175,115,125,0.75));
    border-radius: 2px;
    transition: width 0.3s ease;
  }

  .insight {
    font-family: 'Cormorant Garamond', serif;
    font-style: italic;
    font-size: 0.88rem;
    line-height: 1.6;
    color: #666;
    border-left: 2px solid var(--accent);
    padding-left: 0.8rem;
  }

  .formula {
    font-family: 'Cormorant Garamond', serif;
    font-size: 0.78rem;
    color: #aaa;
    line-height: 1.7;
  }

  .formula strong { color: #777; font-weight: 400; }
</style>
</head>
<body>

<h1>Naar To Blomster Moedes</h1>
<p class="subtitle">Hvor jeres energier overlapper</p>

<div class="layout">
  <div class="canvas-wrap">
    <canvas id="c" width="600" height="440"></canvas>
    <div class="legend">
      <div class="legend-item">
        <div class="legend-swatch" style="background: rgba(100,115,175,0.50)"></div>
        <span>Din energi</span>
      </div>
      <div class="legend-item">
        <div class="legend-swatch" style="background: rgba(175,115,125,0.50)"></div>
        <span>Den andens energi</span>
      </div>
      <div class="legend-item">
        <div class="legend-swatch" style="background: rgba(130,95,150,0.60)"></div>
        <span>Jeres faellesfelt</span>
      </div>
    </div>
  </div>

  <div class="panel">

    <div class="section-title">
      <span class="dot" style="background: rgba(100,115,175,0.75)"></span>
      Dig
    </div>

    <div class="control-group">
      <label>Energiens stoerrelse</label>
      <div class="slider-row">
        <input type="range" id="r1Slider" min="50" max="140" value="95" step="1">
        <span class="val" id="r1Val">95</span>
      </div>
    </div>

    <div class="divider"></div>

    <div class="section-title">
      <span class="dot" style="background: rgba(175,115,125,0.75)"></span>
      Den anden
    </div>

    <div class="control-group">
      <label>Energiens stoerrelse</label>
      <div class="slider-row">
        <input type="range" id="r2Slider" min="50" max="140" value="90" step="1">
        <span class="val" id="r2Val">90</span>
      </div>
    </div>

    <div class="divider"></div>

    <div class="control-group">
      <label>Naerhed</label>
      <div class="slider-row">
        <input type="range" id="sepSlider" min="0" max="300" value="105" step="1">
        <span class="val" id="sepVal">105</span>
      </div>
      <div class="slider-labels">
        <span>Taet</span>
        <span>Fjern</span>
      </div>
    </div>

    <div class="control-group">
      <label>Fase-forskydning</label>
      <div class="slider-row">
        <input type="range" id="phaseSlider" min="0" max="36" value="0" step="1">
        <span class="val" id="phaseVal">0&deg;</span>
      </div>
      <div class="slider-labels">
        <span>Synkron</span>
        <span>Komplementaer</span>
      </div>
    </div>

    <div class="btn-row">
      <button class="preset-btn" id="btnHarmony">&nearr; I harmoni</button>
      <button class="preset-btn outline" id="btnComplement">&loz; Komplementaere</button>
      <button class="preset-btn outline" id="btnApart">&cir; Fjerne</button>
    </div>

    <div class="stats">
      <h3>Energifelter</h3>
      <div class="stat-line">
        <span class="stat-label">Din blomst</span>
        <span class="stat-val" id="sP1" style="color: rgba(80,95,155,1);">&mdash;</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">Den andens blomst</span>
        <span class="stat-val" id="sP2" style="color: rgba(155,95,105,1);">&mdash;</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">Faellesfeltet</span>
        <span class="stat-val" id="sShared" style="color: #6B5F7B; font-weight: 600;">&mdash;</span>
      </div>
      <div class="harmony-wrap">
        <div class="harmony-label">
          <span>Harmoni</span>
          <span id="harmonyPct">&mdash;</span>
        </div>
        <div class="harmony-bar">
          <div class="harmony-fill" id="harmonyFill" style="width: 0%"></div>
        </div>
      </div>
    </div>

    <p class="insight" id="insight">Flyt skyderne for at se hvordan jeres energier moedes.</p>

    <div class="formula">
      <strong>Naarhed</strong> styrer afstanden mellem jeres centre.<br>
      <strong>Fase-forskydning</strong> drejer den andens blomst &mdash;
      synkron (0&deg;) betyder I topper samtidig,
      komplementaer (36&deg;) betyder I udfylder hinandens mellemrum.
    </div>

  </div>
</div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;
const CX = W / 2, CY = H / 2;

// Parameters
let r1 = 95, r2 = 90;
let separation = 105;
let phaseOffset = 0; // degrees 0-36

// 5 petal base angles (72 deg apart, top-aligned)
const BASE = Array.from({length: 5}, (_, i) => -Math.PI / 2 + i * 2 * Math.PI / 5);

function flowerCenters(cx, cy, r, offsetDeg) {
  const d = r * 0.82;
  const off = offsetDeg * Math.PI / 180;
  return BASE.map(a => [
    cx + d * Math.cos(a + off),
    cy + d * Math.sin(a + off)
  ]);
}

// ── Drawing ──────────────────────────────────────────────

function draw() {
  ctx.clearRect(0, 0, W, H);

  const cx1 = CX - separation / 2;
  const cx2 = CX + separation / 2;

  const c1 = flowerCenters(cx1, CY, r1, 0);
  const c2 = flowerCenters(cx2, CY, r2, phaseOffset);

  // 1. Person 1 base petals
  c1.forEach(([px, py]) => {
    ctx.beginPath();
    ctx.arc(px, py, r1, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(100, 115, 175, 0.14)';
    ctx.fill();
  });

  // 2. Person 1 internal 2-petal overlaps
  for (let i = 0; i < 5; i++) {
    const j = (i + 1) % 5;
    const [ax, ay] = c1[i], [bx, by] = c1[j];
    if (dist2d(ax, ay, bx, by) < 2 * r1) {
      ctx.save();
      ctx.beginPath(); ctx.arc(ax, ay, r1, 0, Math.PI * 2); ctx.clip();
      ctx.beginPath(); ctx.arc(bx, by, r1, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(80, 100, 170, 0.16)';
      ctx.fill();
      ctx.restore();
    }
  }

  // 3. Person 1 internal 3-petal overlaps
  for (let i = 0; i < 5; i++) {
    const j = (i + 1) % 5, k = (i + 2) % 5;
    const [ax, ay] = c1[i], [bx, by] = c1[j], [ex, ey] = c1[k];
    if (dist2d(ax, ay, bx, by) < 2 * r1 && dist2d(bx, by, ex, ey) < 2 * r1) {
      ctx.save();
      ctx.beginPath(); ctx.arc(ax, ay, r1, 0, Math.PI * 2); ctx.clip();
      ctx.save();
      ctx.beginPath(); ctx.arc(bx, by, r1, 0, Math.PI * 2); ctx.clip();
      ctx.beginPath(); ctx.arc(ex, ey, r1, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(50, 65, 150, 0.14)';
      ctx.fill();
      ctx.restore(); ctx.restore();
    }
  }

  // 4. Person 1 strokes
  c1.forEach(([px, py]) => {
    ctx.beginPath();
    ctx.arc(px, py, r1, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(80, 95, 155, 0.28)';
    ctx.lineWidth = 0.8;
    ctx.stroke();
  });

  // 5. Person 2 base petals
  c2.forEach(([px, py]) => {
    ctx.beginPath();
    ctx.arc(px, py, r2, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(175, 115, 120, 0.14)';
    ctx.fill();
  });

  // 6. Person 2 internal 2-petal overlaps
  for (let i = 0; i < 5; i++) {
    const j = (i + 1) % 5;
    const [ax, ay] = c2[i], [bx, by] = c2[j];
    if (dist2d(ax, ay, bx, by) < 2 * r2) {
      ctx.save();
      ctx.beginPath(); ctx.arc(ax, ay, r2, 0, Math.PI * 2); ctx.clip();
      ctx.beginPath(); ctx.arc(bx, by, r2, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(170, 95, 115, 0.16)';
      ctx.fill();
      ctx.restore();
    }
  }

  // 7. Person 2 internal 3-petal overlaps
  for (let i = 0; i < 5; i++) {
    const j = (i + 1) % 5, k = (i + 2) % 5;
    const [ax, ay] = c2[i], [bx, by] = c2[j], [ex, ey] = c2[k];
    if (dist2d(ax, ay, bx, by) < 2 * r2 && dist2d(bx, by, ex, ey) < 2 * r2) {
      ctx.save();
      ctx.beginPath(); ctx.arc(ax, ay, r2, 0, Math.PI * 2); ctx.clip();
      ctx.save();
      ctx.beginPath(); ctx.arc(bx, by, r2, 0, Math.PI * 2); ctx.clip();
      ctx.beginPath(); ctx.arc(ex, ey, r2, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(150, 65, 85, 0.14)';
      ctx.fill();
      ctx.restore(); ctx.restore();
    }
  }

  // 8. Person 2 strokes
  c2.forEach(([px, py]) => {
    ctx.beginPath();
    ctx.arc(px, py, r2, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(155, 95, 105, 0.28)';
    ctx.lineWidth = 0.8;
    ctx.stroke();
  });

  // 9. Cross-overlaps: Person 1 petal ∩ Person 2 petal → purple
  for (const [ax, ay] of c1) {
    for (const [bx, by] of c2) {
      if (dist2d(ax, ay, bx, by) < r1 + r2) {
        ctx.save();
        ctx.beginPath(); ctx.arc(ax, ay, r1, 0, Math.PI * 2); ctx.clip();
        ctx.beginPath(); ctx.arc(bx, by, r2, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(130, 95, 155, 0.20)';
        ctx.fill();
        ctx.restore();
      }
    }
  }

  // 10. Deep cross-overlaps: 2 from P1 ∩ 1 from P2 (and vice versa)
  for (let i = 0; i < 5; i++) {
    const j = (i + 1) % 5;
    const [a1x, a1y] = c1[i], [a2x, a2y] = c1[j];
    if (dist2d(a1x, a1y, a2x, a2y) >= 2 * r1) continue;
    for (const [bx, by] of c2) {
      if (dist2d(a1x, a1y, bx, by) < r1 + r2 && dist2d(a2x, a2y, bx, by) < r1 + r2) {
        ctx.save();
        ctx.beginPath(); ctx.arc(a1x, a1y, r1, 0, Math.PI * 2); ctx.clip();
        ctx.save();
        ctx.beginPath(); ctx.arc(a2x, a2y, r1, 0, Math.PI * 2); ctx.clip();
        ctx.beginPath(); ctx.arc(bx, by, r2, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(110, 75, 145, 0.15)';
        ctx.fill();
        ctx.restore(); ctx.restore();
      }
    }
  }

  // 11. Connecting line between centers
  ctx.beginPath();
  ctx.moveTo(cx1, CY);
  ctx.lineTo(cx2, CY);
  ctx.strokeStyle = 'rgba(0, 0, 0, 0.05)';
  ctx.lineWidth = 1;
  ctx.setLineDash([4, 4]);
  ctx.stroke();
  ctx.setLineDash([]);

  // 12. Center dots
  ctx.beginPath();
  ctx.arc(cx1, CY, 3.5, 0, Math.PI * 2);
  ctx.fillStyle = 'rgba(80, 95, 155, 0.50)';
  ctx.fill();

  ctx.beginPath();
  ctx.arc(cx2, CY, 3.5, 0, Math.PI * 2);
  ctx.fillStyle = 'rgba(155, 95, 105, 0.50)';
  ctx.fill();

  // 13. Labels
  ctx.font = '200 10px Jost, sans-serif';
  ctx.textAlign = 'center';
  ctx.fillStyle = 'rgba(80, 95, 155, 0.60)';
  ctx.fillText('DIG', cx1, CY - 10);
  ctx.fillStyle = 'rgba(155, 95, 105, 0.60)';
  ctx.fillText('DEN ANDEN', cx2, CY - 10);

  // Update stats
  updateStats(c1, c2);
}

// ── Helpers ──────────────────────────────────────────────

function dist2d(x1, y1, x2, y2) {
  return Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2);
}

// ── Stats (Monte Carlo) ─────────────────────────────────

function updateStats(c1, c2) {
  const maxR = Math.max(r1, r2);
  const allX = [...c1.map(c => c[0]), ...c2.map(c => c[0])];
  const allY = [...c1.map(c => c[1]), ...c2.map(c => c[1])];
  const minX = Math.min(...allX) - maxR;
  const maxX = Math.max(...allX) + maxR;
  const minY = Math.min(...allY) - maxR;
  const maxY = Math.max(...allY) + maxR;

  const N = 8000;
  let inP1 = 0, inP2 = 0, inBoth = 0;
  const r1sq = r1 * r1, r2sq = r2 * r2;

  for (let i = 0; i < N; i++) {
    const x = minX + Math.random() * (maxX - minX);
    const y = minY + Math.random() * (maxY - minY);

    let in1 = false, in2 = false;
    for (const [cx, cy] of c1) {
      if ((x - cx) ** 2 + (y - cy) ** 2 <= r1sq) { in1 = true; break; }
    }
    for (const [cx, cy] of c2) {
      if ((x - cx) ** 2 + (y - cy) ** 2 <= r2sq) { in2 = true; break; }
    }

    if (in1) inP1++;
    if (in2) inP2++;
    if (in1 && in2) inBoth++;
  }

  const boxArea = (maxX - minX) * (maxY - minY);
  const p1Area = Math.round(inP1 / N * boxArea);
  const p2Area = Math.round(inP2 / N * boxArea);
  const sharedArea = Math.round(inBoth / N * boxArea);

  document.getElementById('sP1').textContent = p1Area.toLocaleString('da-DK') + ' px\u00B2';
  document.getElementById('sP2').textContent = p2Area.toLocaleString('da-DK') + ' px\u00B2';
  document.getElementById('sShared').textContent =
    sharedArea > 80 ? sharedArea.toLocaleString('da-DK') + ' px\u00B2' : '0 (ingen kontakt)';

  const smallerArea = Math.min(p1Area, p2Area);
  const ratio = smallerArea > 0 ? sharedArea / smallerArea : 0;
  const pct = Math.min(100, Math.round(ratio * 100));

  document.getElementById('harmonyPct').textContent = pct + '%';
  document.getElementById('harmonyFill').style.width = pct + '%';

  // Insight in Isabelle's voice
  let msg;
  if (pct >= 75) {
    msg = 'Jeres energier smelter naesten sammen \u2014 I maerker hinanden dybt og intuitivt lige nu.';
  } else if (pct >= 50) {
    msg = 'Et stort faellesfelt \u2014 der er meget energi mellem jer, og I kan maerke hinandens rytme.';
  } else if (pct >= 30) {
    msg = 'I moedes i et meningsfuldt felt \u2014 nok til at noget i jer genkender den anden.';
  } else if (pct >= 15) {
    msg = 'Jeres energier er forskellige lige nu \u2014 det kan skabe nysgerrighed og en anden slags naervaer.';
  } else if (pct > 0) {
    msg = 'I er i meget forskellige rum \u2014 giv plads til hinandens rytme. Der er visdom i afstanden.';
  } else {
    msg = 'Jeres blomster roerer ikke hinanden lige nu \u2014 I lever i adskilte energifelter. Det vender.';
  }
  document.getElementById('insight').textContent = msg;
}

// ── Slider bindings ─────────────────────────────────────

function bindSlider(sliderId, valId, setter, formatter) {
  document.getElementById(sliderId).addEventListener('input', function(e) {
    const v = +e.target.value;
    setter(v);
    document.getElementById(valId).textContent = formatter ? formatter(v) : v;
    draw();
  });
}

bindSlider('r1Slider', 'r1Val', v => r1 = v);
bindSlider('r2Slider', 'r2Val', v => r2 = v);
bindSlider('sepSlider', 'sepVal', v => separation = v);
bindSlider('phaseSlider', 'phaseVal', v => phaseOffset = v, v => v + '\u00B0');

// ── Preset animations ───────────────────────────────────

function animateTo(tR1, tR2, tSep, tPhase) {
  const steps = 45;
  let step = 0;
  const oR1 = r1, oR2 = r2, oSep = separation, oPh = phaseOffset;

  const interval = setInterval(() => {
    step++;
    const t = step / steps;
    const ease = t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t; // ease-in-out

    r1 = Math.round(oR1 + (tR1 - oR1) * ease);
    r2 = Math.round(oR2 + (tR2 - oR2) * ease);
    separation = Math.round(oSep + (tSep - oSep) * ease);
    phaseOffset = Math.round(oPh + (tPhase - oPh) * ease);

    syncSliders();
    draw();
    if (step >= steps) clearInterval(interval);
  }, 16);
}

function syncSliders() {
  document.getElementById('r1Slider').value = r1;
  document.getElementById('r1Val').textContent = r1;
  document.getElementById('r2Slider').value = r2;
  document.getElementById('r2Val').textContent = r2;
  document.getElementById('sepSlider').value = separation;
  document.getElementById('sepVal').textContent = separation;
  document.getElementById('phaseSlider').value = phaseOffset;
  document.getElementById('phaseVal').textContent = phaseOffset + '\u00B0';
}

// "I harmoni" — same size, close, synchronized
document.getElementById('btnHarmony').addEventListener('click', () => {
  animateTo(100, 100, 55, 0);
});

// "Komplementaere" — different sizes, offset, interlocking
document.getElementById('btnComplement').addEventListener('click', () => {
  animateTo(110, 82, 115, 36);
});

// "Fjerne" — small, far apart, partial offset
document.getElementById('btnApart').addEventListener('click', () => {
  animateTo(80, 75, 280, 14);
});

// ── Initial draw ────────────────────────────────────────

draw();
</script>

</body>
</html>
